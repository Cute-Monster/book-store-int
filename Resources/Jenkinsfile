pipeline {
    agent {
        label 'Slave'
    }

    environment {
        CR_GITLAB_TOKEN = credentials('cruntov_gitlab_st')
    }
    stages {
        stage('Git Checkout'){
            steps{
                docker.withServer('https://315727832121.dkr.ecr.us-east-1.amazonaws.com', 'AWS_ECR_CR'){
                    sh('docker build -t 315727832121.dkr.ecr.us-east-1.amazonaws.com/maven-cruntov:latest -f Resources/Dockerfile .')
                    sh('docker push 315727832121.dkr.ecr.us-east-1.amazonaws.com/maven-cruntov')
                }
            }
        }
    }
}